@page "/inicio/configuracion/monedaDashboard/{idempresa:int}"
@using global::Services.Moneda
@using global::Services.EmpresaMonedaService
@using BlazorFrontend.Utility_Class
@using Modelos.Models.Enums
@layout MonedaDashBoardLayout
@inject NavigationManager NavigationManager
@inject EmpresaMonedaService EmpresaMonedaService
@inject MonedaService MonedaService
@inject ISnackbar Snackbar
@inject HttpClient HttpClient
@inject AppStateService AppState

<MudLayout>
    <MudMainContent>
        <MudAppBar Elevation="5" Dense="false">
            <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit"
                           Edge="Edge.Start"
                           OnClick="@ToggleDrawer"/>
            <MudSpacer/>
            <MudIconButton Icon="@Icons.Custom.Brands.GitHub"
                           Color="Color.Inherit"
                           Link="https://github.com/MudBlazor/MudBlazor"
                           Target="_blank"/>
        </MudAppBar>

        <MudDrawer @bind-Open="@_open"
                   ClipMode="DrawerClipMode.Docked"
                   Elevation="1"
                   Variant="@DrawerVariant.Responsive"
                   PreserveOpenState="true"
                   Breakpoint="Breakpoint.Md"
                   OpenMiniOnHover="true">
            <MudNavMenu>
                <MudNavGroup Icon="@Icons.Material.Filled.Business"
                             Title="Contabilidad"
                             @bind-Expanded=IsExpanded>

                    <MudNavLink Icon="@Icons.Material.Filled.CalendarMonth"
                                OnClick="NavigateToGestiones">
                        Gestiones
                    </MudNavLink>

                    <MudNavLink Icon="@Icons.Material.Filled.AccountBalance"
                                OnClick="NavigateToCuentas">
                        Plan de Cuentas
                    </MudNavLink>

                    <MudNavLink Icon="@Icons.Material.Filled.SwapHorizontalCircle"
                                OnClick="CambiarEmpresa">
                        Cambiar empresa
                    </MudNavLink>
                </MudNavGroup>
                <MudNavGroup Icon="@Icons.Material.Filled.Settings"
                             Title="Configuracion">
                    <MudNavLink Icon="@Icons.Material.Filled.CurrencyExchange"
                                OnClick="NavigateToMonedas">
                        Monedas
                    </MudNavLink>
                </MudNavGroup>
            </MudNavMenu>
        </MudDrawer>

        <EditForm Model="EmpresaMonedaDto">
            <DataAnnotationsValidator/>
            <MudTextField Required="true"
                          Label="Moneda Principal"
                          Value="MonedaPrincipalName"
                          Disabled="true"/>
            <MudSelect T="string" Label="Moneda Alternativa"
                       AnchorOrigin="Origin.BottomCenter"
                       @bind-Value="@SelectedMoneda"
                       HelperText="Seleccione una moneda alternativa"
                       Variant="Variant.Text">
                @foreach (var moneda in _monedas.Where(m => m.IdMoneda !=
                                                            MonedaPrincipal.IdMoneda))
                {
                    <MudSelectItem Value="@moneda.Nombre">@moneda.Nombre</MudSelectItem>
                }
            </MudSelect>
            <MudTextField T="float?"
                          @bind-Value="AppState.Cambio"
                          Label="Cambio"
                          Placeholder="0.00"
                          Class="mud-text-field"/>

            <MudButton Color="Color.Success"
                       ButtonType="ButtonType.Submit"
                       Variant="Variant.Filled"
                       OnClick="AddMonedaAlternativa">
                Agregar Moneda Alterna
            </MudButton>
        </EditForm>

        <MudTable Items="@_empresaMonedas.Where(em => em.IdMonedaAlternativa != null)"
                  Hover="true"
                  Breakpoint="Breakpoint.Sm"
                  Bordered="true"
                  Striped="true">
            <HeaderContent>
                <MudTh>
                    <MudTableSortLabel
                        SortBy="new Func<EmpresaMonedaDto, object>(x => x.FechaRegistro)"
                        InitialDirection="SortDirection.Descending">
                        Fecha de registro
                    </MudTableSortLabel>
                </MudTh>
                <MudTh>Moneda Principal</MudTh>
                <MudTh>Moneda Alternativa</MudTh>
                <MudTh>Cambio</MudTh>
                <MudTh>Estado</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="FechaRegistro">@context.FechaRegistro</MudTd>
                <MudTd DataLabel="MonedaAlternativa">@MonedaPrincipal.Nombre</MudTd>
                <MudTd DataLabel="MonedaAlternativa">
                    @GetMonedaAlternativaName(context.IdMonedaAlternativa)
                </MudTd>
                <MudTd DataLabel="Cambio" Style="text-align: right">
                    @context.Cambio
                </MudTd>
                <MudTd DataLabel="Estado" Style="align-content: center">
                    @if (context.Estado == EstadoEmpresaMoneda.Activo)
                    {
                        <MudChip Color="Color.Info">@context.Estado</MudChip>
                    }
                    else
                    {
                        <MudChip Color="Color.Error">@context.Estado</MudChip>
                    }
                </MudTd>
            </RowTemplate>
        </MudTable>
    </MudMainContent>
</MudLayout>

<style>
   .mud-text-field .mud-input input {
        text-align: right;
    }
</style>